<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>تسجيل الدخول</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
@import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap');

body {
  margin:0;
  font-family:"Cairo",sans-serif;
  background:#0f172a;
  color:#fff;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}

.card {
  width:330px;
  background:#1e293b;
  padding:25px;
  border-radius:18px;
  text-align:center;
  box-shadow:0 0 20px rgba(0,0,0,0.4);
}

input, select {
  width:100%;
  padding:12px;
  border-radius:10px;
  border:none;
  margin-bottom:15px;
  background:#334155;
  color:#fff;
}

button {
  width:100%;
  padding:12px;
  border:none;
  border-radius:10px;
  background:#14b8a6;
  font-size:16px;
  cursor:pointer;
}
#error {
  color:#f87171;
  margin-bottom:10px;
}
</style>
</head>

<body>

<div class="card">
  <h2>تسجيل الدخول</h2>

  <div id="error"></div>

  <input id="username" placeholder="اسم المستخدم">
  <input id="password" type="password" placeholder="كلمة المرور">

  <button onclick="login()">دخول</button>
</div>

<script>
const API = "https://moe-users.snh-saud.workers.dev/";

async function login() {
  const err = document.getElementById("error");
  const u = document.getElementById("username").value.trim().toLowerCase();
  const p = document.getElementById("password").value.trim();

  if(!u || !p){
    err.textContent = "الرجاء إدخال اسم المستخدم وكلمة المرور.";
    return;
  }

  let users;
  try {
    users = await fetch(API).then(r => r.json());
  } catch {
    err.textContent = "تعذر الاتصال بالخادم.";
    return;
  }

  const list = users.users || [];
  const user = list.find(x => x.username.toLowerCase() === u && x.password === p);

  if(!user){
    err.textContent = "بيانات الدخول غير صحيحة.";
    return;
  }

  // تحويل المستخدم حسب الدور
  if(user.role === "admin") {
    window.location.href = "admin.html";
  } else {
    window.location.href = "index.html";
  }
}
</script>

</body>
</html>
