<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Ù…Ù„Ù Ø¥Ù†Ø¬Ø§Ø² Ø§Ù„Ù…Ø¹Ù„Ù… - ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØµÙØ­Ø§Øª Ùˆ QR</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet" />

  <style>
    * {
      box-sizing: border-box;
      font-family: "Cairo", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
      "Helvetica Neue", Arial, sans-serif;
    }

    body {
      margin: 0;
      padding: 0;
      background: radial-gradient(circle at top, #0f172a 0%, #020617 55%, #000 100%);
      color: #e5e7eb;
      direction: rtl;
      min-height: 100vh;
    }

    .app-shell {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    header {
      padding: 16px 24px;
      border-bottom: 1px solid rgba(148, 163, 184, 0.25);
      backdrop-filter: blur(10px);
      background: linear-gradient(
        to left,
        rgba(15, 23, 42, 0.94),
        rgba(15, 23, 42, 0.82)
      );
      position: sticky;
      top: 0;
      z-index: 30;
    }

    .header-top {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .brand-logo {
      width: 40px;
      height: 40px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 20%, #4ade80, #22c55e);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #022c22;
      font-weight: 800;
      box-shadow: 0 0 0 1px rgba(15, 23, 42, 0.6), 0 12px 30px rgba(34, 197, 94, 0.5);
      font-size: 20px;
    }

    .brand-text {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .brand-title {
      font-weight: 700;
      font-size: 18px;
      color: #f9fafb;
      letter-spacing: 0.03em;
    }

    .brand-subtitle {
      font-size: 12px;
      color: #9ca3af;
    }

    .user-pill {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 6px 10px 6px 14px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.35);
      background: radial-gradient(circle at top left, #1f2937, #020617);
      box-shadow: 0 10px 25px rgba(15, 23, 42, 0.75);
      font-size: 12px;
      color: #e5e7eb;
    }

    .user-pill-badge {
      width: 24px;
      height: 24px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 20%, #60a5fa, #2563eb);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 13px;
      font-weight: 700;
      color: white;
      box-shadow: 0 0 0 1px rgba(15, 23, 42, 0.9), 0 8px 18px rgba(37, 99, 235, 0.65);
    }

    .header-bottom {
      margin-top: 10px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }

    .header-info {
      display: flex;
      flex-wrap: wrap;
      gap: 8px 16px;
      font-size: 12px;
      color: #9ca3af;
    }

    .header-info span {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 3px 9px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.8);
      border: 1px solid rgba(75, 85, 99, 0.7);
    }

    .header-info span strong {
      color: #e5e7eb;
      font-weight: 600;
    }

    .logout-btn {
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      padding: 5px 12px;
      font-size: 12px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      color: #e5e7eb;
      background: radial-gradient(circle at top left, #1f2937, #020617);
      cursor: pointer;
      box-shadow: 0 10px 20px rgba(15, 23, 42, 0.9);
    }

    .logout-btn span.icon {
      width: 18px;
      height: 18px;
      border-radius: 99px;
      background: #ef4444;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
    }

    main {
      flex: 1;
      padding: 18px 14px 40px;
    }

    .layout {
      max-width: 1200px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: minmax(0, 2.1fr) minmax(0, 1.5fr);
      gap: 18px;
      align-items: flex-start;
    }

    @media (max-width: 960px) {
      .layout {
        grid-template-columns: minmax(0, 1fr);
      }
      header {
        position: static;
      }
    }

    .card-panel {
      background: radial-gradient(circle at top left, #020617, #020617);
      border-radius: 18px;
      padding: 16px 16px 18px;
      border: 1px solid rgba(148, 163, 184, 0.35);
      box-shadow: 0 18px 55px rgba(15, 23, 42, 0.95);
      position: relative;
      overflow: hidden;
    }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 10px;
    }

    .card-title {
      font-size: 16px;
      font-weight: 700;
      color: #f9fafb;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .card-title-badge {
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 11px;
      background: rgba(37, 99, 235, 0.2);
      color: #bfdbfe;
      border: 1px solid rgba(59, 130, 246, 0.75);
    }

    .card-subtitle {
      font-size: 12px;
      color: #9ca3af;
    }

    .chips-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 6px;
      margin-bottom: 10px;
      font-size: 11px;
    }

    .chip {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 3px 8px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.84);
      border: 1px solid rgba(75, 85, 99, 0.9);
      color: #e5e7eb;
    }

    .chip-pill {
      width: 16px;
      height: 16px;
      border-radius: 999px;
      font-size: 11px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #22c55e;
      color: #022c22;
      font-weight: 700;
    }

    .criteria-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 10px;
      margin-top: 10px;
    }

    @media (max-width: 900px) {
      .criteria-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    @media (max-width: 640px) {
      .criteria-grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .criterion-card {
      position: relative;
      padding: 10px 10px 11px;
      border-radius: 12px;
      background: radial-gradient(circle at top left, #020617, #020617);
      border: 1px solid rgba(148, 163, 184, 0.35);
      box-shadow: 0 10px 30px rgba(15, 23, 42, 0.95);
      overflow: hidden;
    }

    .criterion-header {
      position: relative;
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 6px;
      margin-bottom: 6px;
    }

    .criterion-name {
      font-size: 13px;
      font-weight: 700;
      color: #e5e7eb;
    }

    .criterion-count {
      font-size: 11px;
      color: #9ca3af;
    }

    .criterion-count span {
      color: #f97316;
      font-weight: 600;
    }

    .criterion-tag {
      font-size: 10px;
      padding: 2px 7px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      color: #cbd5f5;
      background: rgba(15, 23, 42, 0.85);
    }

    .upload-zone {
      position: relative;
      margin-top: 4px;
      padding: 7px 8px;
      border-radius: 9px;
      background: rgba(15, 23, 42, 0.85);
      border: 1px dashed rgba(148, 163, 184, 0.8);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }

    .upload-zone-main {
      display: flex;
      flex-direction: column;
      gap: 2px;
      font-size: 11px;
    }

    .upload-zone-main span.label {
      color: #e5e7eb;
    }

    .upload-zone-main span.hint {
      color: #9ca3af;
      font-size: 10px;
    }

    .upload-btn {
      padding: 5px 10px;
      font-size: 11px;
      border-radius: 999px;
      border: 1px solid rgba(59, 130, 246, 0.85);
      background: radial-gradient(circle at top left, #1d4ed8, #0f172a);
      color: #eff6ff;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      box-shadow: 0 6px 18px rgba(37, 99, 235, 0.6);
    }

    .upload-btn span.icon {
      font-size: 13px;
    }

    .upload-zone-footer {
      margin-top: 4px;
      font-size: 10px;
      color: #6b7280;
    }

    .hidden-input {
      display: none;
    }

    .bottom-actions {
      margin-top: 16px;
      padding-top: 10px;
      border-top: 1px dashed rgba(148, 163, 184, 0.55);
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
      justify-content: space-between;
    }

    .primary-btn {
      border-radius: 999px;
      padding: 8px 18px;
      font-size: 13px;
      font-weight: 600;
      border: 1px solid rgba(34, 197, 94, 0.95);
      background: linear-gradient(to left, #22c55e, #16a34a);
      color: #022c22;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      box-shadow: 0 16px 40px rgba(22, 163, 74, 0.8);
    }

    .primary-btn span.icon {
      width: 18px;
      height: 18px;
      border-radius: 999px;
      background: #022c22;
      color: #bbf7d0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
    }

    .primary-btn:disabled {
      opacity: 0.5;
      cursor: default;
      box-shadow: none;
    }

    .secondary-btn {
      border-radius: 999px;
      padding: 7px 14px;
      font-size: 12px;
      border: 1px solid rgba(148, 163, 184, 0.65);
      background: radial-gradient(circle at top left, #020617, #020617);
      color: #e5e7eb;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      box-shadow: 0 10px 24px rgba(15, 23, 42, 0.95);
    }

    .secondary-btn span.icon {
      width: 17px;
      height: 17px;
      border-radius: 999px;
      background: #0ea5e9;
      color: #022c22;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
    }

    .status-text {
      font-size: 11px;
      color: #9ca3af;
      margin-top: 6px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.25);
    }

    .status-text.error .status-dot {
      background: #ef4444;
      box-shadow: 0 0 0 4px rgba(239, 68, 68, 0.25);
    }

    .qr-section {
      margin-top: 10px;
      border-radius: 14px;
      padding: 12px 12px 14px;
      background: radial-gradient(circle at top left, rgba(15, 23, 42, 0.95), #020617);
      border: 1px solid rgba(148, 163, 184, 0.45);
      box-shadow: 0 18px 50px rgba(15, 23, 42, 1);
      position: relative;
      overflow: hidden;
    }

    .qr-header {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 8px;
    }

    .qr-grid {
      position: relative;
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 10px;
      margin-top: 4px;
    }

    @media (max-width: 960px) {
      .qr-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    @media (max-width: 640px) {
      .qr-grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .qr-card {
      position: relative;
      padding: 9px 9px 10px;
      border-radius: 10px;
      background: rgba(15, 23, 42, 0.98);
      border: 1px solid rgba(148, 163, 184, 0.8);
      box-shadow: 0 10px 28px rgba(15, 23, 42, 0.95);
      display: flex;
      gap: 8px;
    }

    .qr-card-info {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 4px;
      font-size: 11px;
    }

    .qr-card-title {
      color: #e5e7eb;
      font-weight: 600;
    }

    .qr-card-url {
      color: #9ca3af;
      direction: ltr;
      text-align: left;
      font-size: 10px;
      word-break: break-all;
    }

    .qr-img-box {
      width: 80px;
      min-width: 80px;
      height: 80px;
      border-radius: 8px;
      background: #0b1120;
      border: 1px solid rgba(148, 163, 184, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }

    .qr-actions {
      margin-top: 4px;
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      font-size: 10px;
    }

    .qr-btn {
      padding: 3px 7px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      background: rgba(15, 23, 42, 0.96);
      color: #e5e7eb;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .qr-card-footer {
      margin-top: 4px;
      font-size: 10px;
      color: #6b7280;
    }

    .side-panel {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .side-card {
      background: radial-gradient(circle at top left, #020617, #020617);
      border-radius: 16px;
      padding: 13px 13px 14px;
      border: 1px solid rgba(148, 163, 184, 0.35);
      box-shadow: 0 16px 45px rgba(15, 23, 42, 0.98);
      position: relative;
      overflow: hidden;
      font-size: 12px;
    }

    .side-card-title {
      font-size: 14px;
      font-weight: 600;
      color: #f9fafb;
      margin-bottom: 4px;
    }

    .side-card-subtitle {
      font-size: 11px;
      color: #9ca3af;
      margin-bottom: 8px;
    }

    .teacher-chip {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.96);
      border: 1px solid rgba(148, 163, 184, 0.8);
      font-size: 11px;
      color: #e5e7eb;
      cursor: pointer;
    }

    .teacher-chip span.avatar {
      width: 20px;
      height: 20px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 20%, #22c55e, #16a34a);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: 700;
      color: #022c22;
    }

    .teacher-chip span.id {
      font-family: monospace;
      font-size: 11px;
      color: #9ca3af;
    }

    .teacher-popup-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.75);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 50;
      backdrop-filter: blur(8px);
    }

    .teacher-popup {
      background: #020617;
      border-radius: 16px;
      border: 1px solid rgba(148, 163, 184, 0.65);
      box-shadow: 0 24px 70px rgba(15, 23, 42, 1);
      padding: 14px 16px;
      max-width: 360px;
      width: 100%;
      color: #e5e7eb;
      font-size: 12px;
    }

    .popup-input {
      border-radius: 10px;
      padding: 7px 9px;
      border: 1px solid rgba(148, 163, 184, 0.8);
      background: rgba(15, 23, 42, 0.95);
      color: #e5e7eb;
      font-size: 12px;
      direction: ltr;
      text-align: left;
      width: 100%;
      margin-top: 4px;
    }

    .popup-actions {
      margin-top: 10px;
      display: flex;
      justify-content: flex-end;
      gap: 8px;
    }

    .popup-btn {
      border-radius: 999px;
      padding: 6px 12px;
      font-size: 12px;
      border: 1px solid rgba(148, 163, 184, 0.8);
      background: rgba(15, 23, 42, 0.95);
      color: #e5e7eb;
      cursor: pointer;
    }

    .popup-btn-primary {
      border-color: rgba(34, 197, 94, 0.95);
      background: linear-gradient(to left, #22c55e, #16a34a);
      color: #022c22;
    }

    .loader {
      width: 14px;
      height: 14px;
      border-radius: 999px;
      border: 2px solid rgba(148, 163, 184, 0.25);
      border-top-color: #22c55e;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }
  </style>
</head>
<body>
<div class="app-shell">
  <header>
    <div class="header-top">
      <div class="brand">
        <div class="brand-logo">QR</div>
        <div class="brand-text">
          <div class="brand-title">Ù…Ù„Ù Ø¥Ù†Ø¬Ø§Ø² Ø§Ù„Ù…Ø¹Ù„Ù…</div>
          <div class="brand-subtitle">ØªÙˆÙ„ÙŠØ¯ ØµÙØ­Ø§Øª HTML ÙˆØ±ÙˆØ§Ø¨Ø· QR ÙˆØ±Ø¨Ø·Ù‡Ø§ Ø¨Ù‚Ø§Ù„Ø¨ PowerPoint</div>
        </div>
      </div>
      <div class="user-pill">
        <div class="user-pill-badge">P</div>
        <div>
          <div style="font-weight:600;">Teacher Portfolio</div>
          <div style="font-size:11px;color:#9ca3af;">Ù„ÙˆØ­Ø© Ù…Ø®ØµØµØ© Ù„Ù…Ø¹Ù„Ù… ÙˆØ§Ø­Ø¯</div>
        </div>
      </div>
    </div>
    <div class="header-bottom">
      <div class="header-info">
        <span>ğŸ§‘â€ğŸ« <strong>Ø§Ù„Ù…Ø¹Ù„Ù…:</strong> <span id="teacher-name-label">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø¨Ø¹Ø¯</span></span>
        <span>ğŸ—‚ <strong>Ù…Ø¬Ù„Ø¯ GitHub:</strong> <span id="teacher-folder-label">TEACHER-SA</span></span>
        <span>ğŸ“ <strong>Ù…Ø³Ø§Ø± Ø§Ù„Ø­ÙØ¸:</strong> <span>/docs/&lt;teacher&gt;/criterion-X.html</span></span>
      </div>
      <button class="logout-btn" type="button">
        <span class="icon">â</span>
        <span>ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</span>
      </button>
    </div>
  </header>

  <main>
    <div class="layout">
      <section class="card-panel">
        <div class="card-header">
          <div>
            <div class="card-title">
              Ù…Ù‚Ø§ÙŠÙŠØ³ Ù…Ù„Ù Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²
              <span class="card-title-badge">12 Ù…Ø¹ÙŠØ§Ø±</span>
            </div>
            <div class="card-subtitle">
              Ø§Ø®ØªØ± ØµÙˆØ± Ø§Ù„Ø´ÙˆØ§Ù‡Ø¯ Ù„ÙƒÙ„ Ù…Ø¹ÙŠØ§Ø±ØŒ ÙˆØ³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ ØµÙØ­Ø© HTML Ù„ÙƒÙ„ Ù…Ø¹ÙŠØ§Ø± ÙˆØ±ÙØ¹Ù‡Ø§ Ø¹Ù„Ù‰ GitHub Ù…Ø¹ Ø±Ù…Ø² QR.
            </div>
          </div>
        </div>

        <div class="chips-row">
          <div class="chip"><span class="chip-pill">1</span><span>Ø±ÙØ¹ Ø§Ù„Ø´ÙˆØ§Ù‡Ø¯</span></div>
          <div class="chip"><span class="chip-pill">2</span><span>Ø¥Ù†Ø´Ø§Ø¡ ØµÙØ­Ø§Øª HTML ÙˆØ±ÙØ¹Ù‡Ø§ Ø¹Ù„Ù‰ GitHub</span></div>
          <div class="chip"><span class="chip-pill">3</span><span>ØªÙˆÙ„ÙŠØ¯ QR ÙˆØ±Ø¨Ø·Ù‡Ø§ Ø¨Ø§Ù„Ø´Ø±Ø§Ø¦Ø­ ÙÙŠ PowerPoint</span></div>
        </div>

        <div id="criteria-grid" class="criteria-grid"></div>

        <div class="bottom-actions">
          <div>
            <button id="btn-generate" class="primary-btn" type="button">
              <span class="icon">ğŸš€</span>
              <span>ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØµÙØ­Ø§Øª Ùˆ QR</span>
            </button>
            <div class="status-text" id="status-text">
              <div class="status-dot"></div>
              <span>Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¹Ù…Ù„</span>
              <small>Ø§Ø®ØªØ± ØµÙˆØ± Ø§Ù„Ø´ÙˆØ§Ù‡Ø¯ Ø«Ù… Ø§Ø¶ØºØ· Ø²Ø± Ø§Ù„ØªÙˆÙ„ÙŠØ¯</small>
            </div>
          </div>
          <button id="btn-admin" class="secondary-btn" type="button">
            <span class="icon">ğŸ› </span>
            <span>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù… / Ø§Ù„Ù…Ø¬Ù„Ø¯</span>
          </button>
        </div>
      </section>

      <section class="side-panel">
        <div class="side-card">
          <div class="side-card-title">Ø±ÙˆØ§Ø¨Ø· ÙˆØµÙØ­Ø§Øª Ø§Ù„Ù…Ù‚Ø§ÙŠÙŠØ³ (QR)</div>
          <div class="side-card-subtitle">ØªÙÙ†Ø´Ø£ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ø¹Ø¯ Ø±ÙØ¹ Ø§Ù„ØµÙØ­Ø§Øª Ø¥Ù„Ù‰ GitHub</div>
          <div id="qr-section" class="qr-section" style="display:none;">
            <div class="qr-header">
              <div>
                <div style="font-size:14px;font-weight:600;color:#f9fafb;">Ø±ÙˆØ§Ø¨Ø· ØµÙØ­Ø§Øª Ø§Ù„Ù…Ø¹Ø§ÙŠÙŠØ±</div>
                <div style="font-size:11px;color:#9ca3af;">ÙŠÙ…ÙƒÙ† Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù‡Ø°Ù‡ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ ÙˆÙÙŠ Ø´Ø±Ø§Ø¦Ø­ Ø§Ù„Ø¨ÙˆØ±Ø¨ÙˆÙŠÙ†Øª.</div>
              </div>
            </div>
            <div id="qr-grid" class="qr-grid"></div>
          </div>
          <div id="qr-empty" style="font-size:11px;color:#6b7280;">Ù„Ù… ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø£ÙŠ ØµÙØ­Ø§Øª Ø¨Ø¹Ø¯.</div>
        </div>

        <div class="side-card">
          <div class="side-card-title">ØªÙƒØ§Ù…Ù„ PowerPoint</div>
          <div class="side-card-subtitle">
            Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ù„Ù <strong>template.pptx</strong> Ù…Ù† Ù†ÙØ³ Ø§Ù„Ù…Ø¬Ù„Ø¯ØŒ ÙˆÙˆØ¶Ø¹ ÙƒÙ„ Ø±Ù…Ø² QR Ù…ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ·ÙŠÙ„ Ø§Ù„ÙˆØ±Ø¯ÙŠ Ø¨Ø¯Ø§ÙŠØ© Ù…Ù† Ø§Ù„Ø´Ø±ÙŠØ­Ø© 8.
          </div>
          <button id="btn-export-pptx" class="secondary-btn" type="button">
            <span class="icon">ğŸ“¤</span>
            <span>ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù PowerPoint</span>
          </button>
          <div style="font-size:10px;color:#6b7280;margin-top:6px;">
            Ø³ÙŠØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù Ø¨Ø§Ø³Ù… Ù…Ø¬Ù„Ø¯ Ø§Ù„Ù…Ø¹Ù„Ù…ØŒ Ù…Ø«Ù„Ø§Ù‹: <code>TEACHER-SA.pptx</code>.
          </div>
        </div>

        <div class="side-card">
          <div class="side-card-title">Ø§Ù„Ù…Ø¹Ù„Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ</div>
          <div class="side-card-subtitle">ÙŠÙ…ÙƒÙ† ØªØºÙŠÙŠØ± Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ù…Ø¬Ù„Ø¯ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù….</div>
          <button id="teacher-chip" type="button" class="teacher-chip">
            <span class="avatar">P</span>
            <span id="teacher-chip-name">Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ù„Ù…</span>
            <span class="id" id="teacher-chip-folder">/TEACHER-SA</span>
          </button>
          <p style="font-size:11px;color:#9ca3af;margin-top:6px;">
            Ø³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØµÙØ­Ø§Øª ÙØ¹Ù„ÙŠØ§Ù‹ ÙÙŠ:
            <br>
            <code style="direction:ltr;text-align:left;display:inline-block;">/docs/&lt;teacher&gt;/criterion-X.html</code>
          </p>
        </div>
      </section>
    </div>
  </main>
</div>

<!-- Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ© -->
<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>
<!-- Ù…ÙƒØªØ¨Ø© zip (Ù„Ùˆ Ø§Ø­ØªØ¬Ù†Ø§Ù‡Ø§ Ù…Ø³ØªÙ‚Ø¨Ù„Ø§Ù‹) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

<!-- Ù…ÙƒØªØ¨Ø© Ø­ÙØ¸ Ø§Ù„Ù…Ù„ÙØ§Øª FileSaver -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
<!-- Ù…ÙƒØªØ¨Ø© Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„ÙØ§Øª PowerPoint (PptxGenJS) -->
<script src="https://cdn.jsdelivr.net/gh/gitbrent/pptxgenjs/dist/pptxgen.bundle.js"></script>

<!-- Ù…ÙƒØªØ¨Ø© QR Code -->
<script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>

<script>
// Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø¹Ø§Ù…Ø©
const state = {
  criteria: [],
  teacherName: "",
  teacherFolder: "TEACHER-SA",
  workerUrl: "https://moe-uploader.snh-saud.workers.dev/",
  baseUrl: "https://xsf3x.github.io/MOE-SA",
  qrCanvases: []
};

const criteriaNames = [
  "Ø§Ù„Ù…Ø¹ÙŠØ§Ø± Ø§Ù„Ø£ÙˆÙ„",
  "Ø§Ù„Ù…Ø¹ÙŠØ§Ø± Ø§Ù„Ø«Ø§Ù†ÙŠ",
  "Ø§Ù„Ù…Ø¹ÙŠØ§Ø± Ø§Ù„Ø«Ø§Ù„Ø«",
  "Ø§Ù„Ù…Ø¹ÙŠØ§Ø± Ø§Ù„Ø±Ø§Ø¨Ø¹",
  "Ø§Ù„Ù…Ø¹ÙŠØ§Ø± Ø§Ù„Ø®Ø§Ù…Ø³",
  "Ø§Ù„Ù…Ø¹ÙŠØ§Ø± Ø§Ù„Ø³Ø§Ø¯Ø³",
  "Ø§Ù„Ù…Ø¹ÙŠØ§Ø± Ø§Ù„Ø³Ø§Ø¨Ø¹",
  "Ø§Ù„Ù…Ø¹ÙŠØ§Ø± Ø§Ù„Ø«Ø§Ù…Ù†",
  "Ø§Ù„Ù…Ø¹ÙŠØ§Ø± Ø§Ù„ØªØ§Ø³Ø¹",
  "Ø§Ù„Ù…Ø¹ÙŠØ§Ø± Ø§Ù„Ø¹Ø§Ø´Ø±",
  "Ø§Ù„Ù…Ø¹ÙŠØ§Ø± Ø§Ù„Ø­Ø§Ø¯ÙŠ Ø¹Ø´Ø±",
  "Ø§Ù„Ù…Ø¹ÙŠØ§Ø± Ø§Ù„Ø«Ø§Ù†ÙŠ Ø¹Ø´Ø±"
];

// Ø¨Ù†Ø§Ø¡ ÙƒØ±ÙˆØª Ø§Ù„Ù…Ø¹Ø§ÙŠÙŠØ±
function buildCards() {
  const grid = document.getElementById("criteria-grid");
  grid.innerHTML = "";
  state.criteria = [];

  criteriaNames.forEach((name, index) => {
    const id = index + 1;

    const card = document.createElement("div");
    card.className = "criterion-card";

    const header = document.createElement("div");
    header.className = "criterion-header";

    const titleBox = document.createElement("div");
    const title = document.createElement("div");
    title.className = "criterion-name";
    title.textContent = name;

    const count = document.createElement("div");
    count.className = "criterion-count";
    count.innerHTML = 'Ø¹Ø¯Ø¯ Ø§Ù„ØµÙˆØ±: <span id="count-' + id + '">0</span>';

    titleBox.appendChild(title);
    titleBox.appendChild(count);

    const tag = document.createElement("div");
    tag.className = "criterion-tag";
    tag.textContent = "Ù…Ø¬Ù„Ø¯ Ù…Ø³ØªÙ‚Ù„ Ù„Ù„ØµÙˆØ±";

    header.appendChild(titleBox);
    header.appendChild(tag);
    card.appendChild(header);

    const uploadZone = document.createElement("div");
    uploadZone.className = "upload-zone";

    const main = document.createElement("div");
    main.className = "upload-zone-main";
    const label = document.createElement("span");
    label.className = "label";
    label.textContent = "Ø§Ø®ØªØ± ØµÙˆØ± Ø§Ù„Ø´ÙˆØ§Ù‡Ø¯";

    const hint = document.createElement("span");
    hint.className = "hint";
    hint.textContent = "ÙŠÙ…ÙƒÙ† Ø§Ø®ØªÙŠØ§Ø± Ø£ÙƒØ«Ø± Ù…Ù† ØµÙˆØ±Ø© Ù„Ù„Ù…Ù‚ÙŠØ§Ø³ Ù†ÙØ³Ù‡";

    main.appendChild(label);
    main.appendChild(hint);

    const btn = document.createElement("button");
    btn.className = "upload-btn";
    btn.type = "button";
    btn.innerHTML = '<span class="icon">ğŸ“</span><span>Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±</span>';

    const footer = document.createElement("div");
    footer.className = "upload-zone-footer";
    footer.innerHTML =
      "Ø³ÙŠØªÙ… Ø±ÙØ¹ Ø§Ù„ØµÙˆØ± Ø¥Ù„Ù‰ GitHub Ø«Ù… Ø±Ø¨Ø·Ù‡Ø§ Ø¨ØµÙØ­Ø© HTML Ø®Ø§ØµØ© Ø¨Ù‡Ø°Ø§ Ø§Ù„Ù…Ø¹ÙŠØ§Ø±.";

    uploadZone.appendChild(main);
    uploadZone.appendChild(btn);
    card.appendChild(uploadZone);
    card.appendChild(footer);

    const input = document.createElement("input");
    input.type = "file";
    input.accept = "image/*";
    input.multiple = true;
    input.className = "hidden-input";
    card.appendChild(input);

    btn.addEventListener("click", () => input.click());
    input.addEventListener("change", () => {
      const files = Array.from(input.files || []);
      state.criteria[id - 1].files = files;
      document.getElementById("count-" + id).textContent = files.length;
    });

    const footerInfo = document.createElement("div");
    footerInfo.className = "upload-zone-footer";
    footerInfo.innerHTML =
      "Ø³ÙŠØªÙ… Ø­ÙØ¸ ØµÙØ­Ø© Ù‡Ø°Ø§ Ø§Ù„Ù…Ø¹ÙŠØ§Ø± ÙÙŠ: <code>/docs/&lt;teacher&gt;/criterion-" +
      id +
      ".html</code>";
    card.appendChild(footerInfo);

    grid.appendChild(card);

    state.criteria.push({
      id,
      name,
      files: []
    });
  });
}

// ØªØ­Ø¯ÙŠØ« Ø³Ø·Ø± Ø§Ù„Ø­Ø§Ù„Ø©
function setStatus(message, isError = false) {
  const el = document.getElementById("status-text");
  el.className = "status-text" + (isError ? " error" : "");
  el.innerHTML = `
    <div class="status-dot"></div>
    <span>${message}</span>
    <small>${isError ? "ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØ£Ø¹Ø¯ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©" : "Ø§Ù†ØªØ¸Ø± Ø­ØªÙ‰ ØªÙƒØªÙ…Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©"}</small>
  `;
}

// Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø²Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
function setLoading(isLoading) {
  const btn = document.getElementById("btn-generate");
  btn.disabled = isLoading;
  btn.innerHTML = isLoading
    ? '<span class="icon"><div class="loader"></div></span><span>Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©â€¦ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±â€¦</span>'
    : '<span class="icon">ğŸš€</span><span>ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØµÙØ­Ø§Øª Ùˆ QR</span>';
}

// Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø²Ø± PPTX
function setPptxLoading(isLoading) {
  const btn = document.getElementById("btn-export-pptx");
  btn.disabled = isLoading;
  btn.innerHTML = isLoading
    ? '<span class="icon"><div class="loader"></div></span><span>Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù PowerPointâ€¦</span>'
    : '<span class="icon">ğŸ“¤</span><span>ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù PowerPoint</span>';
}

function showQrSection(show) {
  document.getElementById("qr-section").style.display = show ? "block" : "none";
  document.getElementById("qr-empty").style.display = show ? "none" : "block";
}

// ØªØ­Ø¯ÙŠØ« Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ù„Ù… ÙˆØ§Ù„Ù…Ø¬Ù„Ø¯ ÙÙŠ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
function updateTeacherUI() {
  const name = state.teacherName || "Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø¨Ø¹Ø¯";
  const folder = state.teacherFolder || "TEACHER-SA";
  document.getElementById("teacher-name-label").textContent = name;
  document.getElementById("teacher-folder-label").textContent = folder;
  document.getElementById("teacher-chip-name").textContent = name;
  document.getElementById("teacher-chip-folder").textContent = "/" + folder;
}

// Ø¥Ù†Ø´Ø§Ø¡ popup Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù…
const popupBackdrop = document.createElement("div");
popupBackdrop.className = "teacher-popup-backdrop";
popupBackdrop.innerHTML = `
  <div class="teacher-popup">
    <div style="display:flex;align-items:center;justify-content:space-between;gap:8px;margin-bottom:8px;">
      <div style="font-size:14px;font-weight:600;display:flex;align-items:center;gap:8px;">
        <span style="width:22px;height:22px;border-radius:999px;background:radial-gradient(circle at 30% 20%,#22c55e,#16a34a);display:flex;align-items:center;justify-content:center;font-size:13px;color:#022c22;font-weight:700;">ğŸ‘¤</span>
        <span>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù… ÙˆØ§Ù„Ù…Ø¬Ù„Ø¯</span>
      </div>
      <button class="popup-btn" type="button" id="popup-close">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
    <div>
      <div style="margin-bottom:8px;">
        <div style="font-size:11px;color:#9ca3af;">Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ù„Ù… (ÙŠØ¸Ù‡Ø± ÙÙŠ Ø§Ù„Ø£Ø¹Ù„Ù‰ ÙˆÙÙŠ Ù…Ù„Ù Ø§Ù„Ø¨ÙˆØ±Ø¨ÙˆÙŠÙ†Øª):</div>
        <input id="popup-teacher-name" class="popup-input" type="text" placeholder="Ù…Ø«Ø§Ù„: Ø£/ Ø³Ø¹ÙˆØ¯ Ø§Ù„Ø´Ø±ÙŠÙ" />
      </div>
      <div style="margin-bottom:8px;">
        <div style="font-size:11px;color:#9ca3af;">Ø§Ø³Ù… Ù…Ø¬Ù„Ø¯ Ø§Ù„Ù…Ø¹Ù„Ù… ÙÙŠ GitHub (Ø­Ø±ÙˆÙ Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© ÙÙ‚Ø·):</div>
        <input id="popup-teacher-folder" class="popup-input" type="text" placeholder="TEACHER-SA" />
        <div style="font-size:10px;color:#6b7280;margin-top:4px;">
          Ø³ÙŠØªÙ… Ø­ÙØ¸ Ø§Ù„ØµÙØ­Ø§Øª ÙØ¹Ù„ÙŠØ§Ù‹ ÙÙŠ:
          <br>
          <code style="direction:ltr;text-align:left;display:inline-block;">/docs/&lt;teacher-folder&gt;/criterion-X.html</code>
          <br>
          Ø¨ÙŠÙ†Ù…Ø§ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø¯Ø§Ø®Ù„ QR Ø³ØªÙƒÙˆÙ†:
          <br>
          <code style="direction:ltr;text-align:left;display:inline-block;">https://xsf3x.github.io/MOE-SA/&lt;teacher-folder&gt;/criterion-X.html</code>
        </div>
      </div>
      <div class="popup-actions">
        <button class="popup-btn" type="button" id="popup-cancel">Ø¥Ù„ØºØ§Ø¡</button>
        <button class="popup-btn popup-btn-primary" type="button" id="popup-save">Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</button>
      </div>
    </div>
  </div>
`;
document.body.appendChild(popupBackdrop);

function openTeacherPopup() {
  document.getElementById("popup-teacher-name").value = state.teacherName || "";
  document.getElementById("popup-teacher-folder").value = state.teacherFolder || "TEACHER-SA";
  popupBackdrop.style.display = "flex";
}

function closeTeacherPopup() {
  popupBackdrop.style.display = "none";
}

popupBackdrop.addEventListener("click", (e) => {
  if (e.target === popupBackdrop) closeTeacherPopup();
});
document.getElementById("btn-admin").addEventListener("click", openTeacherPopup);
document.getElementById("teacher-chip").addEventListener("click", openTeacherPopup);
popupBackdrop.querySelector("#popup-close").addEventListener("click", closeTeacherPopup);
popupBackdrop.querySelector("#popup-cancel").addEventListener("click", closeTeacherPopup);
popupBackdrop.querySelector("#popup-save").addEventListener("click", () => {
  const name = document.getElementById("popup-teacher-name").value.trim();
  let folder = document.getElementById("popup-teacher-folder").value.trim();
  folder = folder.replace(/[^a-zA-Z0-9_-]/g, "");
  if (!folder) {
    alert("Ø§Ø³Ù… Ù…Ø¬Ù„Ø¯ Ø§Ù„Ù…Ø¹Ù„Ù… Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙƒÙˆÙ† ÙØ§Ø±ØºØ§Ù‹.");
    return;
  }
  state.teacherName = name || "Ù…Ø¹Ù„Ù… Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…";
  state.teacherFolder = folder;
  updateTeacherUI();
  closeTeacherPopup();
});

// Ø±ÙØ¹ HTML Ø¥Ù„Ù‰ GitHub Ø¹Ø¨Ø± Cloudflare Worker
async function githubUpload(path, content) {
  const res = await fetch(state.workerUrl, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ path, content })
  });

  if (!res.ok) {
    const txt = await res.text();
    console.error("Worker error:", txt);
    throw new Error("ÙØ´Ù„ Ø§Ù„Ø±ÙØ¹ Ø¥Ù„Ù‰ GitHub");
  }

  const out = await res.json().catch(() => ({}));
  console.log("Worker response:", out);
}

// ØªØ­ÙˆÙŠÙ„ Ù†Øµ HTML Ù„Ø¢Ù…Ù†
function htmlEscape(str) {
  return str
    .replace(/&/g, "&amp;")
    .replace(/"/g, "&quot;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;");
}

// Ù…Ù„Ù â†’ DataURL
function fileToDataURL(file) {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onload = () => resolve(reader.result);
    reader.onerror = reject;
    reader.readAsDataURL(file);
  });
}
// Ø¥Ù†Ø´Ø§Ø¡ ØµÙØ­Ø© HTML Ø¬Ø§Ù‡Ø²Ø© Ù„Ù…Ø¹ÙŠØ§Ø± ÙˆØ§Ø­Ø¯
function buildCriterionHtml(teacherName, criterionName, imgTags) {
  return `
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8"/>
<title>${teacherName} - ${criterionName}</title>
<style>
  body {
    font-family: "Cairo", sans-serif;
    background: #f8fafc;
    margin: 0;
    padding: 0;
    color: #0f172a;
  }
  header {
    background: #0f172a;
    color: white;
    padding: 14px 20px;
    font-size: 18px;
    font-weight: 700;
  }
  .container {
    padding: 18px;
  }
  .criterion-title {
    font-size: 20px;
    font-weight: 700;
    margin-bottom: 12px;
  }
  .img-box {
    margin-bottom: 18px;
    border: 1px solid #cbd5e1;
    border-radius: 10px;
    overflow: hidden;
    background: white;
    box-shadow: 0 4px 10px rgba(0,0,0,0.08);
  }
  .img-box img {
    width: 100%;
    display: block;
  }
</style>
</head>
<body>
<header>${teacherName} â€” ${criterionName}</header>
<div class="container">
  <div class="criterion-title">${criterionName}</div>
  ${imgTags}
</div>
</body>
</html>`;
}

// Ø¥Ù†Ø´Ø§Ø¡ <img> HTML
function buildImgTags(filesDataUrls) {
  return filesDataUrls
    .map((dataUrl) => `<div class="img-box"><img src="${dataUrl}" /></div>`)
    .join("\n");
}

// ØªÙˆÙ„ÙŠØ¯ ØµÙØ­Ø§Øª HTML ÙˆØ±ÙØ¹Ù‡Ø§ + ØªÙˆÙ„ÙŠØ¯ Ø±ÙˆØ§Ø¨Ø·Ù‡Ø§
async function generateHtmlPages() {
  const teacherFolder = state.teacherFolder;
  const teacherName = state.teacherName;

  const qrLinks = [];

  for (let c of state.criteria) {
    const critId = c.id;
    const critName = c.name;
    const files = c.files;

    // ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØµÙˆØ± Ø¥Ù„Ù‰ base64
    const imgsDataUrls = [];
    for (let file of files) {
      const dataUrl = await fileToDataURL(file);
      imgsDataUrls.push(dataUrl);
    }

    const imgTags = buildImgTags(imgsDataUrls);

    const htmlContent = buildCriterionHtml(teacherName, critName, imgTags);

    // Ù…Ø³Ø§Ø± Ø§Ù„Ø±ÙØ¹ Ø¯Ø§Ø®Ù„ GitHub
    const githubPath = `docs/${teacherFolder}/criterion-${critId}.html`;

    // Ø§Ù„Ø±ÙØ¹ Ø¹Ø¨Ø± Ø§Ù„Ù€ Worker
    await githubUpload(githubPath, htmlContent);

    // Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ø¨Ø¯ÙˆÙ† docs
    const pageUrl = `${state.baseUrl}/${teacherFolder}/criterion-${critId}.html`;

    qrLinks.push({
      id: critId,
      name: critName,
      url: pageUrl
    });
  }

  return qrLinks;
}

// ØªÙˆÙ„ÙŠØ¯ QR Ø¨ØµÙŠØºØ© Base64
async function generateQrBase64(url) {
  return new Promise((resolve, reject) => {
    QRCode.toDataURL(
      url,
      {
        width: 600,
        margin: 2,
        color: {
          dark: "#000000",
          light: "#ffffff"
        }
      },
      function (err, dataUrl) {
        if (err) return reject(err);
        resolve(dataUrl);
      }
    );
  });
}

// Ø¹Ø±Ø¶ Ø´Ø¨ÙƒØ© QR
function renderQrGrid(qrLinks, qrBase64List) {
  const grid = document.getElementById("qr-grid");
  grid.innerHTML = "";

  qrLinks.forEach((item, idx) => {
    const card = document.createElement("div");
    card.className = "qr-card";

    const info = document.createElement("div");
    info.className = "qr-card-info";

    const title = document.createElement("div");
    title.className = "qr-card-title";
    title.textContent = item.name;

    const url = document.createElement("div");
    url.className = "qr-card-url";
    url.textContent = item.url;

    info.appendChild(title);
    info.appendChild(url);

    const imgBox = document.createElement("div");
    imgBox.className = "qr-img-box";

    const qimg = document.createElement("img");
    qimg.src = qrBase64List[idx];
    imgBox.appendChild(qimg);

    card.appendChild(info);
    card.appendChild(imgBox);

    grid.appendChild(card);
  });

  showQrSection(true);
}

// PPTX â€” ÙˆØ¶Ø¹ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ù…ÙƒØ§Ù† Ø§Ù„Ù„ÙˆÙ† Ø§Ù„ÙˆØ±Ø¯ÙŠ
async function generatePPTX() {
  try {
    setPptxLoading(true);

    const qrImgs = state.qrCanvases;

    const templateBytes = await fetch("template.pptx").then(r => r.arrayBuffer());

    let pptx = new PptxGenJS();
    await pptx.load(templateBytes);

    const startSlide = 8;

    // Ù…ÙƒØ§Ù† QR (Ø¥Ù†Ø´)
    const qrX = 6.20;
    const qrY = 4.25;
    const qrW = 2.80;
    const qrH = 2.80;

    qrImgs.forEach((dataUrl, idx) => {
      const slideIndex = startSlide + idx - 1;
      const slide = pptx.slides[slideIndex];
      if (!slide) return;

      slide.addImage({
        data: dataUrl,
        x: qrX,
        y: qrY,
        w: qrW,
        h: qrH
      });
    });

    const fileName = state.teacherFolder + ".pptx";
    await pptx.writeFile({ fileName });

  } catch (err) {
    alert("Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ù†Ø´Ø§Ø¡ PPTX: " + err.message);
  }

  setPptxLoading(false);
}

// ØªØ´ØºÙŠÙ„ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªÙˆÙ„ÙŠØ¯ ÙƒØ§Ù…Ù„Ø©
async function generateAll() {
  if (!state.teacherFolder.trim()) {
    alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ­Ø¯ÙŠØ¯ Ø§Ø³Ù… Ù…Ø¬Ù„Ø¯ Ø§Ù„Ù…Ø¹Ù„Ù….");
    return;
  }

  try {
    setLoading(true);
    setStatus("Ø¬Ø§Ø±ÙŠ ØªÙˆÙ„ÙŠØ¯ ØµÙØ­Ø§Øª HTML ÙˆØ±ÙØ¹Ù‡Ø§ Ø¥Ù„Ù‰ GitHubâ€¦");

    // 1) ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØµÙØ­Ø§Øª ÙˆØ±ÙØ¹Ù‡Ø§
    const qrLinks = await generateHtmlPages();

    setStatus("Ø¬Ø§Ø±ÙŠ ØªÙˆÙ„ÙŠØ¯ Ø±Ù…ÙˆØ² QRâ€¦");

    // 2) ØªÙˆÙ„ÙŠØ¯ QR base64
    const qrBase64List = [];
    for (let link of qrLinks) {
      const dataUrl = await generateQrBase64(link.url);
      qrBase64List.push(dataUrl);
    }

    state.qrCanvases = qrBase64List;

    setStatus("ØªÙ… Ø§Ù„ØªÙˆÙ„ÙŠØ¯ Ø¨Ù†Ø¬Ø§Ø­ ğŸ‘");
    renderQrGrid(qrLinks, qrBase64List);

  } catch (err) {
    console.error(err);
    setStatus("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©", true);
  } finally {
    setLoading(false);
  }
}

// ØªØ´ØºÙŠÙ„ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
document.addEventListener("DOMContentLoaded", () => {
  buildCards();
  updateTeacherUI();
});

// Ø±Ø¨Ø· Ø²Ø± PPTX
document.getElementById("btn-export-pptx")
  .addEventListener("click", generatePPTX);

</script>
</body>
</html>

